<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAS9ie-yt-XgKtsGYRVXRZj17N2KiyhcLA",
    authDomain: "releasemanagerag.firebaseapp.com",
    databaseURL: "https://releasemanagerag-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "releasemanagerag",
    storageBucket: "releasemanagerag.appspot.com",
    messagingSenderId: "241143916735",
    appId: "1:241143916735:web:ada7cc6de3b0bb50e43e0a"
  };
  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();

  function saveChange(element, type) {
      const value = element.value;
      const releaseId = element.closest('.release-box').querySelector('h2').innerText;

      const data = {
          releaseId: releaseId,
          type: type,
          value: value
      };

      firebase.database().ref('changes/' + releaseId).set(data);

      if (type === 'progress') {
          updateProgress(element);
      }
  }

  function applyChange(change) {
      const releaseBox = document.querySelector(`.release-box h2:contains('${change.releaseId}')`).closest('.release-box');
      if (change.type === 'progress') {
          const progressInput = releaseBox.querySelector('.progress-input');
          progressInput.value = change.value;
          updateProgress(progressInput);
      } else if (change.type === 'changelog') {
          const changelogArea = releaseBox.querySelector('textarea');
          changelogArea.value = change.value;
      }
  }

  firebase.database().ref('changes').on('value', (snapshot) => {
      const changes = snapshot.val();
      for (let key in changes) {
          applyChange(changes[key]);
      }
  });

  document.addEventListener('DOMContentLoaded', function() {
      var progressInputs = document.querySelectorAll('.progress-input');
      progressInputs.forEach(input => updateProgress(input));
  });
</script>
